<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch√∫c M·ª´ng NƒÉm M·ªõi 2026</title>
    <style>
        :root { --gold: #ffd700; --red-dark: #4b0000; --red-light: #9e0000; --lixi: #d32f2f; }
        body { 
            margin: 0; background: radial-gradient(circle, var(--red-light) 0%, var(--red-dark) 100%);
            color: var(--gold); font-family: 'Segoe UI', Arial, sans-serif; 
            height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        canvas { position: fixed; top: 0; left: 0; z-index: 1; pointer-events: none; }
        #lixi-container { position: relative; z-index: 10; cursor: pointer; text-align: center; }
        .lixi {
            width: 160px; height: 250px; background: var(--lixi);
            border-radius: 15px; position: relative; border: 3px solid var(--gold);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            animation: wobble 2s infinite; box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }
        .circle-open {
            width: 65px; height: 65px; background: var(--gold); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: #b71c1c; font-weight: bold; font-size: 1.3rem; border: 3px solid #fff;
        }
        @keyframes wobble { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }
        .card { 
            position: relative; z-index: 2; padding: 30px; border: 5px solid var(--gold); 
            background: rgba(0, 0, 0, 0.95); border-radius: 35px; width: 90%; max-width: 650px; 
            display: none; opacity: 0; transform: scale(0.8);
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .card.active { display: block; opacity: 1; transform: scale(1); }
        h1 { margin: 0; font-size: 1.4rem; border-bottom: 2px solid var(--gold); padding-bottom: 10px; }
        #name { font-size: 2.8rem; color: #fff; margin: 15px 0; display: block; font-weight: bold; text-shadow: 0 0 10px var(--gold); }
        #wish { 
            font-size: 16px !important; line-height: 1.7; color: #fdfdfd; 
            white-space: pre-wrap; min-height: 200px; background: rgba(255, 215, 0, 0.05);
            padding: 20px; border-radius: 15px; border-left: 4px solid var(--gold);
        }
        .footer { text-align: center; margin-top: 20px; font-size: 2rem; }
    </style>
</head>
<body>
    <canvas id="fireworks"></canvas>
    <div id="lixi-container" onclick="openLixi()">
        <div class="lixi"><div class="circle-open">M·ªû</div></div>
        <p style="color:var(--gold); font-weight:bold; margin-top:15px; text-shadow: 1px 1px 2px #000;">B·∫•m ƒë·ªÉ nh·∫≠n l√¨ x√¨!</p>
    </div>
    <div class="card" id="main-card"><div id="content-body"></div></div>

    <script>
    // Link chu·∫©n c·ªßa b·∫°n
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4Ac7TOm2fuHtn3AfNHa6mZE371XP85Yu3CWNxtgCgtl26KZawLofyW6esQCv4oeXzJAQnGuFHmfZK/pub?gid=0&single=true&output=csv';
    
    let finalName = "B·∫°n";
    let finalWish = "Ch√∫c m·ª´ng nƒÉm m·ªõi 2026 r·ª±c r·ª°!";

    async function loadData() {
        const urlParams = new URLSearchParams(window.location.search);
        // Chuy·ªÉn ID v·ªÅ ch·ªØ th∆∞·ªùng ƒë·ªÉ so s√°nh cho d·ªÖ
        const targetId = urlParams.get('id')?.toLowerCase().trim();

        if (!targetId) return;

        try {
            // Th√™m Date.now() ƒë·ªÉ √©p tr√¨nh duy·ªát kh√¥ng l·∫•y b·∫£n c≈© (cache)
            const response = await fetch(CSV_URL + '&cachebuster=' + Date.now());
            const rawData = await response.text();
            
            // X·ª≠ l√Ω file CSV: T√°ch d√≤ng v√† lo·∫°i b·ªè k√Ω t·ª± r√°c ƒë·∫ßu file
            const rows = rawData.replace(/^\uFEFF/, '').split(/\r?\n/);
            
            // Duy·ªát t·ª´ d√≤ng 2 (b·ªè qua d√≤ng ti√™u ƒë·ªÅ ID, WISH)
            for (let i = 1; i < rows.length; i++) {
                // T√°ch c·ªôt theo d·∫•u ph·∫©y chu·∫©n CSV
                const columns = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                
                if (columns.length >= 2) {
                    let idInSheet = columns[0].replace(/^"|"$/g, '').trim();
                    let wishInSheet = columns[1].replace(/^"|"$/g, '').trim();

                    // So s√°nh kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng
                    if (idInSheet.toLowerCase() === targetId) {
                        finalName = idInSheet; 
                        finalWish = wishInSheet || finalWish;
                        console.log("ƒê√£ t√¨m th·∫•y d·ªØ li·ªáu:", finalName);
                        break;
                    }
                }
            }
        } catch (error) {
            console.error("L·ªói ƒë·ªçc d·ªØ li·ªáu:", error);
        }
    }

    function openLixi() {
        document.getElementById('lixi-container').style.display = 'none';
        const card = document.getElementById('main-card');
        card.style.display = 'block';
        setTimeout(() => card.classList.add('active'), 50);
        renderContent(finalName, finalWish);
    }

    function renderContent(n, w) {
        document.getElementById('content-body').innerHTML = `
            <h1>üßß CH√öC M·ª™NG NƒÇM M·ªöI</h1>
            <span id="name">${n} ∆°i!</span>
            <div id="wish"></div>
            <div class="footer">üå∏ üß® üßß</div>
        `;
        const wishDiv = document.getElementById("wish");
        // H·ªó tr·ª£ c·∫£ xu·ªëng d√≤ng b·∫±ng <br> ho·∫∑c ph√≠m Enter
        let cleanText = w.replace(/<br\s*\/?>/gi, '\n');
        let i = 0;
        function typeWriter() {
            if (i < cleanText.length) {
                wishDiv.textContent += cleanText.charAt(i);
                i++;
                setTimeout(typeWriter, 60); // ƒê·∫©y t·ªëc ƒë·ªô nhanh h∆°n x√≠u cho ƒë·ª° s·ªët ru·ªôt
            }
        }
        typeWriter();
        // B·∫Øn ph√°o hoa ƒÉn m·ª´ng
        for(let j=0; j<8; j++) setTimeout(() => createFirework(Math.random()*window.innerWidth, Math.random()*window.innerHeight), j*400);
    }

    // --- LOGIC PH√ÅO HOA (GI·ªÆ NGUY√äN) ---
    const canvas = document.getElementById('fireworks'), ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    let p = [];
    class Particle {
        constructor(x, y, c) {
            this.x = x; this.y = y; this.c = c;
            this.v = { x: (Math.random()-0.5)*10, y: (Math.random()-0.5)*10 };
            this.a = 1;
        }
        draw() { ctx.save(); ctx.globalAlpha = this.a; ctx.beginPath(); ctx.arc(this.x, this.y, 2.5, 0, Math.PI*2); ctx.fillStyle = this.c; ctx.fill(); ctx.restore(); }
        update() { this.x += this.v.x; this.y += this.v.y; this.a -= 0.01; }
    }
    function createFirework(x, y) {
        const colors = ['#ffd700', '#ff3131', '#00ff00', '#00ffff', '#ffffff'];
        const color = colors[Math.floor(Math.random()*colors.length)];
        for(let i=0; i<80; i++) p.push(new Particle(x, y, color));
    }
    function animate() {
        ctx.fillStyle = 'rgba(0,0,0,0.2)'; ctx.fillRect(0,0,canvas.width,canvas.height);
        p.forEach((it, i) => { if(it.a > 0) { it.update(); it.draw(); } else p.splice(i, 1); });
        requestAnimationFrame(animate);
    }
    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    animate(); 
    loadData();
</script>
</body>

</html>

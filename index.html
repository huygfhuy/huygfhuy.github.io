<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch√∫c M·ª´ng NƒÉm M·ªõi 2026</title>
    <style>
        :root { --gold: #ffd700; --red-dark: #4b0000; --red-light: #9e0000; --lixi: #d32f2f; }
        * { box-sizing: border-box; }
        body { 
            margin: 0; padding: 0;
            background: radial-gradient(circle, var(--red-light) 0%, var(--red-dark) 100%);
            color: var(--gold); font-family: 'Segoe UI', Arial, sans-serif; 
            height: 100vh; width: 100vw;
            display: flex; justify-content: center; align-items: center; 
            overflow: hidden; position: relative;
        }
        canvas { position: fixed; top: 0; left: 0; z-index: 1; pointer-events: none; }
        
        #lixi-wrap {
            position: relative; z-index: 10;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .lixi {
            width: 160px; height: 250px; 
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            border-radius: 15px; border: 2px solid var(--gold);
            display: flex; align-items: center; justify-content: center;
            animation: wobble 1.5s infinite; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.7);
            position: relative; cursor: pointer;
        }

        .lixi::before {
            content: ""; position: absolute; top: 0; width: 100%; height: 45px;
            background: #9e0000; border-radius: 15px 15px 50% 50%; border-bottom: 2px solid var(--gold);
        }

        /* N√∫t m·ªü c√≥ tr·∫°ng th√°i ch·ªù */
        .circle-open {
            width: 80px; height: 80px; background: radial-gradient(circle, #fff9c4, var(--gold));
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: #b71c1c; font-weight: bold; font-size: 1.5rem; border: 4px solid #8d0000;
            box-shadow: 0 0 20px var(--gold); z-index: 2;
            transition: all 0.3s;
        }
        .circle-open.waiting {
            background: #ccc; color: #666; border-color: #999; box-shadow: none; cursor: not-allowed;
        }

        @keyframes wobble { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }

        .card { 
            position: absolute; z-index: 20; padding: 25px; border: 4px solid var(--gold); 
            background: rgba(0, 0, 0, 0.96); border-radius: 30px; width: 90%; max-width: 500px; 
            display: none; opacity: 0; transform: scale(0.5);
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
        }
        .card.active { display: block; opacity: 1; transform: scale(1); }
        h1 { font-size: 1.2rem; margin: 0; padding-bottom: 10px; border-bottom: 1px solid var(--gold); }
        #name { font-size: 2rem; color: #fff; margin: 15px 0; display: block; font-weight: bold; text-shadow: 0 0 10px var(--gold); }
        #wish { font-size: 15px; line-height: 1.6; color: #fff; white-space: pre-wrap; min-height: 120px; padding: 15px; border-radius: 15px; border: 1px dashed var(--gold); background: rgba(255,255,255,0.05); }
        .footer-text { font-size: 0.9rem; margin-top: 15px; color: var(--gold); opacity: 0.9; line-height: 1.4; }
        #music-control { position: fixed; bottom: 20px; right: 20px; z-index: 100; background: var(--gold); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 18px; }
    </style>
</head>
<body>

    <iframe id="music-player" width="0" height="0" src="https://www.youtube.com/embed/HK2eoCbiBPg?enablejsapi=1" frameborder="0" allow="autoplay" style="display:none"></iframe>
    
    <button id="music-control" onclick="toggleMusic()">üéµ</button>
    <canvas id="fireworks"></canvas>

    <div id="lixi-wrap">
        <div class="lixi" onclick="attemptOpen()">
            <div id="btn-open" class="circle-open waiting">5</div>
        </div>
        <p id="lixi-note" style="color:var(--gold); font-weight:bold; margin-top:20px; text-shadow: 2px 2px 4px #000;">üßß ƒê·ª£i x√≠u nh√©... üßß</p>
    </div>

    <div class="card" id="main-card">
        <h1>üßß HAPPY NEW YEAR 2026 üßß</h1>
        <span id="name">ƒêang t·∫£i...</span>
        <div id="wish"></div>
        <div class="footer-text">üå∏üßßüß® nh·ªõ l√¨ x√¨ cho tui nha üß®üßßüå∏</div>
    </div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vReifCieYeae54H_1UEYD43ETUGjAWeleLtIFKRadnlaM3H-I7dsTeaoRhFZREssmJ08HCjXV900Oms/pub?gid=0&single=true&output=csv';
        let finalName = "B·∫°n b√®", finalWish = "Ch√∫c m·ª´ng nƒÉm m·ªõi 2026 r·ª±c r·ª°!";
        let isMusicPlaying = false;
        let canOpen = false;
        let timeLeft = 5;

        // H√†m ƒë·∫øm ng∆∞·ª£c
        function startCountdown() {
            const btn = document.getElementById('btn-open');
            const note = document.getElementById('lixi-note');
            
            const timer = setInterval(() => {
                timeLeft--;
                if (timeLeft > 0) {
                    btn.innerText = timeLeft;
                } else {
                    clearInterval(timer);
                    canOpen = true;
                    btn.innerText = "M·ªû";
                    btn.classList.remove('waiting');
                    note.innerText = "üßß Nh·∫•n ƒë·ªÉ nh·∫≠n l√¨ x√¨! üßß";
                }
            }, 1000);
        }

        async function loadData() {
            const urlParams = new URLSearchParams(window.location.search);
            const targetId = urlParams.get('id')?.toLowerCase().trim();
            if (!targetId) { document.getElementById('name').innerText = "B·∫°n b√®"; return; }
            try {
                const response = await fetch(CSV_URL + '&t=' + Date.now());
                const rawData = await response.text();
                const rows = rawData.replace(/^\uFEFF/, '').split(/\r?\n/);
                for (let i = 1; i < rows.length; i++) {
                    const columns = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^!]*$)/);
                    if (columns.length >= 2) {
                        let idInSheet = columns[0].replace(/^"|"$/g, '').trim();
                        if (idInSheet.toLowerCase() === targetId) {
                            finalName = idInSheet;
                            finalWish = columns[1].replace(/^"|"$/g, '').trim();
                            break;
                        }
                    }
                }
                document.getElementById('name').innerText = finalName + " ∆°i!";
            } catch (e) { console.error("L·ªói data:", e); }
        }

        function toggleMusic() {
            const player = document.getElementById('music-player');
            if(!isMusicPlaying) {
                player.src += "&autoplay=1";
                isMusicPlaying = true;
            } else {
                player.src = player.src.split('&autoplay')[0];
                isMusicPlaying = false;
            }
        }

        function attemptOpen() {
            if (canOpen) {
                openLixi();
            }
        }

        function openLixi() {
            if(!isMusicPlaying) toggleMusic();
            document.getElementById('lixi-wrap').style.display = 'none';
            const card = document.getElementById('main-card');
            card.style.display = 'block';
            setTimeout(() => card.classList.add('active'), 50);
            
            let i = 0;
            const wishDiv = document.getElementById('wish');
            function type() {
                if (i < finalWish.length) {
                    wishDiv.textContent += finalWish.charAt(i);
                    i++; setTimeout(type, 50);
                }
            }
            type();
            for(let j=0; j<15; j++) setTimeout(() => createFirework(Math.random()*window.innerWidth, Math.random()*window.innerHeight), j*200);
        }

        // --- PH√ÅO HOA --- (Gi·ªØ nguy√™n nh∆∞ b·∫£n tr∆∞·ªõc)
        const canvas = document.getElementById('fireworks'), ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let particles = [];
        class Particle {
            constructor(x, y, color, vel) {
                this.x = x; this.y = y; this.color = color; this.vel = vel;
                this.alpha = 1; this.friction = 0.95; this.gravity = 0.18;
            }
            update() {
                this.vel.x *= this.friction; this.vel.y *= this.friction; this.vel.y += this.gravity;
                this.x += this.vel.x; this.y += this.vel.y; this.alpha -= 0.012;
            }
            draw() {
                ctx.save(); ctx.globalAlpha = this.alpha; ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI*2); ctx.fillStyle = this.color; ctx.fill(); ctx.restore();
            }
        }
        function createFirework(x, y) {
            const colors = ['#ffd700', '#ff3131', '#ffffff', '#00ff00', '#00ffff'];
            const color = colors[Math.floor(Math.random()*colors.length)];
            const particleCount = 100;
            for(let i=0; i < particleCount; i++) {
                const angle = (Math.PI*2 / particleCount) * i;
                const speed = Math.random()*10 + 2;
                particles.push(new Particle(x, y, color, { x: Math.cos(angle)*speed, y: Math.sin(angle)*speed }));
            }
        }
        function animate() {
            ctx.fillStyle = 'rgba(0,0,0,0.2)'; ctx.fillRect(0,0,canvas.width,canvas.height);
            particles.forEach((p, i) => { if(p.alpha > 0){ p.update(); p.draw(); } else particles.splice(i,1); });
            if(Math.random() < 0.04) createFirework(Math.random()*canvas.width, Math.random()*canvas.height*0.7);
            requestAnimationFrame(animate);
        }
        window.addEventListener('mousedown', (e) => createFirework(e.clientX, e.clientY));
        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
        
        animate(); 
        loadData(); 
        startCountdown(); // G·ªçi h√†m ƒë·∫øm ng∆∞·ª£c khi v√†o trang
    </script>
</body>
</html>

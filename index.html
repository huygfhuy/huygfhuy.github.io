<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChÃºc Má»«ng NÄƒm Má»›i 2026</title>
    <style>
        :root { --gold: #ffd700; --red-dark: #4b0000; --red-light: #9e0000; --lixi: #d32f2f; }
        body { 
            margin: 0; background: radial-gradient(circle, var(--red-light) 0%, var(--red-dark) 100%);
            color: var(--gold); font-family: 'Segoe UI', Arial, sans-serif; 
            height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        canvas { position: fixed; top: 0; left: 0; z-index: 1; pointer-events: none; }
        
        /* BAO LÃŒ XÃŒ 3D */
        #lixi-container { position: relative; z-index: 10; cursor: pointer; text-align: center; perspective: 1000px; }
        .lixi {
            width: 170px; height: 260px; background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            border-radius: 12px; position: relative; border: 2px solid var(--gold);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            animation: wobble 1.5s infinite; box-shadow: 0 20px 50px rgba(0,0,0,0.7);
        }
        .lixi::before {
            content: ""; position: absolute; top: 0; width: 100%; height: 50px;
            background: #9e0000; border-radius: 12px 12px 50% 50%; border-bottom: 2px solid var(--gold);
        }
        .circle-open {
            width: 75px; height: 75px; background: radial-gradient(circle, #fff9c4, var(--gold));
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: #b71c1c; font-weight: bold; font-size: 1.5rem; border: 4px solid #8d0000;
            box-shadow: 0 0 20px var(--gold); z-index: 2;
        }
        @keyframes wobble { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }

        /* THIá»†P CHÃšC */
        .card { 
            position: relative; z-index: 2; padding: 30px; border: 4px solid var(--gold); 
            background: rgba(0, 0, 0, 0.96); border-radius: 35px; width: 85%; max-width: 600px; 
            display: none; opacity: 0; transform: scale(0.5);
            transition: all 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.4);
        }
        .card.active { display: block; opacity: 1; transform: scale(1); }
        h1 { margin: 0; font-size: 1.3rem; border-bottom: 2px solid var(--gold); padding-bottom: 10px; text-align: center; }
        #name { font-size: 2.5rem; color: #fff; margin: 15px 0; display: block; font-weight: bold; text-align: center; text-shadow: 0 0 10px var(--gold); }
        #wish { font-size: 17px; line-height: 1.8; color: #fff; white-space: pre-wrap; min-height: 180px; padding: 20px; border-radius: 15px; border: 1px dashed var(--gold); }
        .footer { text-align: center; margin-top: 20px; font-size: 2rem; }

        /* NÃšT NHáº C */
        #music-control { position: fixed; bottom: 20px; right: 20px; z-index: 100; background: var(--gold); border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

    <div id="player-container" style="display:none">
        <iframe id="music-player" width="0" height="0" src="https://www.youtube.com/embed/HK2eoCbiBPg?enablejsapi=1&loop=1&playlist=HK2eoCbiBPg" frameborder="0" allow="autoplay"></iframe>
    </div>
    
    <button id="music-control" onclick="toggleMusic()">ðŸŽµ</button>
    <canvas id="fireworks"></canvas>

    <div id="lixi-container" onclick="openLixi()">
        <div class="lixi"><div class="circle-open">Má»ž</div></div>
        <p style="color:var(--gold); font-weight:bold; margin-top:20px; font-size: 1.1rem; text-shadow: 2px 2px 4px #000;">ðŸ§§ Nháº¥n Ä‘á»ƒ khai xuÃ¢n & nghe nháº¡c! ðŸ§§</p>
    </div>

    <div class="card" id="main-card"><div id="content-body"></div></div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4Ac7TOm2fuHtn3AfNHa6mZE371XP85Yu3CWNxtgCgtl26KZawLofyW6esQCv4oeXzJAQnGuFHmfZK/pub?gid=0&single=true&output=csv';
        let finalName = "Báº¡n bÃ¨", finalWish = "ChÃºc má»«ng nÄƒm má»›i 2026 rá»±c rá»¡!";
        let musicPlaying = false;

        async function loadData() {
            const urlParams = new URLSearchParams(window.location.search);
            const targetId = urlParams.get('id')?.toLowerCase().trim();
            if (!targetId) return;
            try {
                const response = await fetch(CSV_URL + '?t=' + Date.now());
                const rawData = await response.text();
                const rows = rawData.replace(/^\uFEFF/, '').split(/\r?\n/);
                for (let i = 1; i < rows.length; i++) {
                    const columns = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if (columns.length >= 2) {
                        let idInSheet = columns[0].replace(/^"|"$/g, '').trim();
                        if (idInSheet.toLowerCase() === targetId) {
                            finalName = idInSheet;
                            finalWish = columns[1].replace(/^"|"$/g, '').trim();
                            break;
                        }
                    }
                }
            } catch (e) { console.error(e); }
        }

        function toggleMusic() {
            const player = document.getElementById('music-player');
            if(!musicPlaying) {
                player.src += "&autoplay=1";
                musicPlaying = true;
            } else {
                player.src = player.src.replace("&autoplay=1", "");
                musicPlaying = false;
            }
        }

        function openLixi() {
            // Tá»± Ä‘á»™ng báº­t nháº¡c khi má»Ÿ lÃ¬ xÃ¬
            if(!musicPlaying) toggleMusic();
            
            document.getElementById('lixi-container').style.display = 'none';
            const card = document.getElementById('main-card');
            card.style.display = 'block';
            setTimeout(() => card.classList.add('active'), 50);
            renderContent(finalName, finalWish);
            
            // PhÃ¡o hoa Ä‘áº¡i tiá»‡c khi má»Ÿ
            for(let i=0; i<20; i++) {
                setTimeout(() => createFirework(Math.random()*window.innerWidth, Math.random()*window.innerHeight), i*150);
            }
        }

        function renderContent(n, w) {
            document.getElementById('content-body').innerHTML = `
                <h1>ðŸ§§ CHÃšC Má»ªNG NÄ‚M Má»šI 2026</h1>
                <span id="name">${n} Æ¡i!</span>
                <div id="wish"></div>
                <div class="footer">ðŸŒ¸ ðŸ§§ ðŸ§¨</div>
            `;
            const wishDiv = document.getElementById("wish");
            let cleanText = w.replace(/<br\s*\/?>/gi, '\n');
            let i = 0;
            function typeWriter() {
                if (i < cleanText.length) {
                    wishDiv.textContent += cleanText.charAt(i);
                    i++;
                    setTimeout(typeWriter, 50);
                }
            }
            typeWriter();
        }

        // --- Há»† THá»NG PHÃO HOA DÃ€Y Äáº¶C ---
        const canvas = document.getElementById('fireworks'), ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let particles = [];

        class Particle {
            constructor(x, y, color, velocity) {
                this.x = x; this.y = y; this.color = color; this.velocity = velocity;
                this.alpha = 1; this.friction = 0.96; this.gravity = 0.15;
            }
            draw() {
                ctx.save(); ctx.globalAlpha = this.alpha; ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2); ctx.fillStyle = this.color;
                ctx.fill(); ctx.restore();
            }
            update() {
                this.velocity.x *= this.friction; this.velocity.y *= this.friction;
                this.velocity.y += this.gravity;
                this.x += this.velocity.x; this.y += this.velocity.y;
                this.alpha -= 0.012;
            }
        }

        function createFirework(x, y) {
            const count = 120; // Cá»±c nhiá»u máº£nh vá»¥n
            const angleStep = (Math.PI * 2) / count;
            const colors = [`hsl(${Math.random() * 360}, 100%, 60%)`, '#ffd700', '#ffffff', '#ff3131'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            for (let i = 0; i < count; i++) {
                const speed = Math.random() * 15 + 2;
                particles.push(new Particle(x, y, color, {
                    x: Math.cos(angleStep * i) * speed,
                    y: Math.sin(angleStep * i) * speed
                }));
            }
        }

        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, i) => {
                if (p.alpha > 0) { p.update(); p.draw(); } 
                else { particles.splice(i, 1); }
            });
            if (Math.random() < 0.1) { // TÄƒng tá»· lá»‡ ná»• tá»± Ä‘á»™ng
                createFirework(Math.random() * canvas.width, Math.random() * canvas.height * 0.7);
            }
            requestAnimationFrame(animate);
        }

        window.addEventListener('mousedown', (e) => createFirework(e.clientX, e.clientY));
        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
        animate(); loadData();
    </script>
</body>
</html>
